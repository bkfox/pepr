{% extends "pepr/content/service.html" %}
{% load i18n pepr_api pepr_ui %}

{% block app %}
<div class="box mb-3">
    {% component create_form role service=service %}
</div>

<hr>

<p-list id-attr="pk" observe
    :connection="connection"
    :filter="{context: '{{ context.pk }}'}"
    path="/api/content/"
    pubsub-filter="context"
    pubsub-lookup="{{ context.pk }}"
    >
    {% for obj in object_list %}
    <template slot="data">
        {% serialize obj role=role render=False as data %}
        {{ data|json_script:obj.pk }}
    </template>
    {% endfor %}

    <template v-slot:item="{list,item,index}">
        <v-runtime-template v-if="item.data.html" :template="item.data.html">
        </v-runtime-template>
        {% for obj in object_list %}
        <template v-else-if="item.key=='{{ obj.pk }}'">
            {% component obj.as_component %}
        </template>
        {% endfor %}
    </template>
</p-list>

{% comment %}
<pepr-bound-collection id-attr="pk" sort-attr="-modified" observe
    collection-url="/container/{{ context.pk }}/"
    items-url="/content/" >

    {% for obj in object_list %}
    <div data-id="{{ obj.pk }}">
        {% serialize obj role=role as data %}
        {{ data|json_script:obj.pk }}
        {% component obj.as_component %}
    </div>
    {% endfor %}

    <template slot="after" slot-scope="{parent, collection}">
        <div class="text-center">
            <button @click.prevent="parent.load">{% trans "more..." %}</button>
        </div>
    </template>

    <template slot="item" slot-scope="{item}">
        <pepr-dynamic :html="item.html" :elm="item.elm"
            :key="this.idAttr" :data="item">
        </pepr-dynamic>
    </template>
</pepr-container>

{% endcomment %}

{% endblock %}

