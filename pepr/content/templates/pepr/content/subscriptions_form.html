{% extends "pepr/content/service.html" %}
{% load i18n widget_tweaks pepr_api pepr_ui %}

{% block app %}
<h3>{% icon "fa-user-friends fas" %} {% trans "Subscriptions" %}</h3>
<div class="box">
    <p class="lead mb-3">
    {% with title=context.title context_type=context|meta:"verbose_name" %}
    {% blocktrans %}
    Here you can change users subscriptions for the {{ context_type }}
    <b>{{ title }}</b>.
    {% endblocktrans %}
    {% endwith %}
    </p>

    {% fetch_slot view.slots "item_actions" role=role as item_actions %}

    <nav class="navbar justify-content-end" ref="sub-filters"
        aria-label="{% trans "Subscription Filters" %}"
        aria-description="{% trans "Filters for the list of subscriptions" %}"
        >

        <form class="form-inline"
            @submit.prevent="$refs.subscriptions.formFilter($event.target)">
            <input type="hidden" name="context" value="{{ context.id }}" />
            <select id="sub-filter-status" class="form-control form-control-sm mr-2"
                name="status">
                <option value="" aria-label="No status">-- {% trans "Status" %} --</option>
                {% for status,label in statuses %}
                <option value="{{status}}">{{ label }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-sm btn-primary">Filter</button>
        </form>
    </nav>

    <p-table path="{% url "subscription-list" %}"
            ref="subscriptions"
            class="table table-sm table-bordered table-striped"
            {% if context %}:query="{context:'{{ context.pk }}'}"{% endif %}>
        <template v-slot:header>
            <thead>
                <th scope="col" class="col-3">User</th>
                <th scope="col" class="col-1">Role</th>
                <th scope="col" class="col-1">Status</th>
                <th scope="col" class="col-2"></th>
            </thead>
        </template>

        <template v-slot:item="{list,item,index}">
            <td>[[ item.data.owner.username ]]</td>
            <td>
                <select class="form-control form-control-sm"
                    v-model="item.data.role">
                    {% for value,label in roles %}
                    <option value={{ value }}>{{ label }}</option>
                    {% endfor %}
                </select>
            </td>
            <td>
            {% for status,label in statuses %}
                <span v-if="item.data.status == {{ status }}">
                {{ label }}
                </span>
            {% endfor %}
            </td>
            <td class="align-right">
                {% slot view.slots "item_actions" items=item_actions %}
            </td>
        </template>
    </p-table>
</div>
{% endblock %}


